---
layout: post
title: Vulnversity
date: 2021-06-24 01:52:00 -17
categories: [TryHackMe, 'Offensive Pentesting']
tags: [walkthrough]
---

Vulnversity is the second room in the Offensive Pentesting. It is designed to hepl you learn how to scan and access machines, end with you doing privilege escalation.
## Task 1 -- Deploying the Machine

The first step is to turn on the machine\
![Task1]({{ '/assets/task1.jpg' | relative_url }})

Dont forget to turn on OpenVp `openvpn VpnFile.opvn`


## Task 2 -- Reconnaissance
Task 2 require you to use nmap to scan the attack machines IP. nmap is a free, open-source network scanner. Using the -sV, which tries to determine the services running and what versions they are.
Using the command `nmap -sV IP_Address` and allowing it time to run, you should get\
![Task2]({{ '/assets/task2.jpg' | relative_url }})

<details>
    <summary>Click To See The Anwers</summary>

    Scan the box, how many ports are open? 6 <br>
    What version of the squid proxy is running on the machine? 3.5.12<br>
    How many ports will nmap scan if the flag -p-400 was used? 400<br>
    Using the nmap flag -n what will it not resolve? DNS<br>
    What is the most likely operating system this machine is running? Ubuntu<br>
    What port is the web server running on? 3333<br>
</details>

## Task 3 -- Using GoBuster to locate directories
Gobuster is an free, open-source tool that brute-forces URI's to find the directories and files on website.
You will first need to install gobuster. If you are on kali 2020.1, install by running `sudo apt-get install gobuster`
If you are on another OS, you will need to follow the link and installing from the github [here](https://github.com/OJ/gobuster).

After that has installed, you will need to locate the world list. On kali use `cd /usr/share/worldlists`, I went into the `dirbuster` directory and picked `directory-list-2.3-small.txt`<br>
Next, I ran `gobuster dir -u http://IP_address:3333 -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt`<br>
This is a good time to stand-up and get some water, it will take some time.<br>

After some time, you will see a few options show up
![Task3]({{ '/assets/task3.jpg' | relative_url }})
It might be useful to see if any of these are what we are looking for<br>
`http://IP_Address:3333/`

<details>
    <summary>Click To See The Answers</summary>
    What is the directory that has an upload form page? /internal/
</details>

## Task 4 -- Compromising the webserver
Now that we have our upload form, we need to compromise it by uploading a file, but it seems that some file extensions are blocked.
<details>
    <summary>Click To See The Answers</summary>
    what common extension seems to be blocked? .php
</details>

To find out which extensions are blocked, I used burpsuit.<br>
To use burp, we first need to launch it, I just use the default settings until I reached this page.
<img src="/assets/task4.jpg" alt="Task4"><br>
At the top, click on the proxy tab and make sure Intercept is on
<img src="/assets/task4.1.jpg" alt="Task4.1"><br>
Next we need to configure our browser to use burp's proxy, in Firefox click the 3 line in the top right and mouse down to <em>Preferences</em>, in the preference menu search bar type in <em>Proxy</em>, and click the online option. Burp's proxy address is `127.0.0.1`. You will need to type that in under the manual proxy config option.
<img src="/assets/task4.2.jpg" alt="Task4.2"><br>
Then click OK.
Now go back to the upload form page again. `http://IP_Address:3333/internal/`.<br>
You will notice that it will not load, that is normal. Burp has captured the request and it waiting for you. Go back to burp and click on the forward button. You should now see the upload form page.<br>
Now we need to make our attack list, make a text document, it can be named anything, I chose `phptext.txt`, containing these extensions
```
.php
.php3
.php4
.php5
.phtml
```
Now that we have that, we need to click on the <em>Intruder</em> option, it should be right next to <em>Proxy</em>. Under <em>Payload</em> click <em>Load ...</em> and load the `phptext.txt` that we created earlier.<br>
For the attack to work correctly we need to first capture and upload. Make sure that your browser is on the upload form page. Next click on the <em>Submit</em> button and you should see this appear in burp.
<img src="/assets/task4.3.jpg" alt="Task 4.3"><br>
Now we send it to <em>Intruder</em>, we can either use `Ctrl+I`, or the <em>Action</em> button and then <em>Send to Intruder</em>.<br>
Next we need to update the filename line to look like this. Click the Clear option on the side, then type `shell.php` after the filename=""<br>
Next highlight the .php you just added and click on the add button on the side.
It should look like this.
<img src="/assets/task4.4.jpg" alt="Task 4.4"><br>
Make sure you go to <em>Payloads</em>, and at the very bottom turn off encoding. It will not work otherwise.<br>
Next go to options andd down to Grep - Match and turn it on. Next click clear, and then add `Extension Not Allowed`. It should look like this.<br>
<img src="/assets/task4.5.jpg" alt="Task 4.5"><br>
Now click Start Attack!
<details>
    <summary>Click for Answer</summary>
    Run this attack, what extension is allowed? .phtml
    <img src="/assets/task4.6.jpg" alt="Task 4 Answer"><br>
</details>
Now we need to get our code, I will be using a php reverse shell. Kali comes with some shell preinstalled. Using cp (copy), to bring the shell file to our working directory, `cp /usr/share/webshells/php/php-reverse-shell.php`. We need to change the `$ip` line and the `$port` line (Optional). By running `ifconfig` and finding your systems ip and placing in the correct line. Next use the mv command to rename the file with the allowed extension `mv php-reverse-shell.php reverse.phtml`. You can rename it to anything you want I chose reverse.phtml<br>
Now that we have that done we need to start netcat. Netcat is a tool that allows for port scanning and port listening. We need to use `nc -nlvp 444`.<br> 
The -n stops netcat from doing any naming or service lookups, the -l sets netcat up for listening, -v is for verbose output, and -p is for specifying the port.<br>
Now it is time to upload the reverse shell file. Go back to `http://IP_Address:3333/internal/` and upload the file. Now go to `http://IP_Address:3333/uploads/` and click on the reverse shell. You should see that netcat has a connection. Now see if you can answer the questions!
<details>
    <summary>Click for Answer</summary>
    What is the name of the user who manages the webserver? Bill
    What is the user flag? 8bd7992fbe8a6ad22a63361004cfcedb
</details>


## Task 5 -- Privilege Escalation